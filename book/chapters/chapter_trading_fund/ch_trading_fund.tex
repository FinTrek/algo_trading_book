% !TEX root = ../../book.tex

\chapter{Trading Fundamentals}

\section{A Brief History of Stock Trading}
Stoll (2006)~\cite{hstoll} in an instructive essay traces the evolution of trading that started under a tree in 1792 with 24 brokers. This has become later on the New York Stock Exchange (NYSE). Modern electronic technology has changed how trading is done. Now all transactions are carried out though a computer system with little human intervention (see the snapshots of NYSE over two different decades).
	\begin{figure}[!ht]
   	\centering
   	\includegraphics[width=0.9\textwidth]{chapters/chapter_trading_fund/figures/pit_trading.png} 
   	\caption{Treasury bind pit 1989. \label{fig:pittrade}}
	\end{figure}
	\begin{figure}[!ht]
	   \centering
	   \includegraphics[width=0.9\textwidth]{chapters/chapter_trading_fund/figures/electronic_trading.png} 
	   \caption{The NYSE trading floor in August 2008. \label{fig:electrade}}
	\end{figure}
This has also changed how stock market trading is done. The Electronic Communication Networks (ECN) automate the trading process but the fundamental functions of trading are not changed except for the instant dissemination of the demand and supply information to all investors. The identity of traders is kept anonymous. Executions are done fast and very complex orders can now be submitted to the market. The trading costs---both direct such as commissions, brokerage fees, etc. and indirect cost due to price-impact---are expected to be lower. Over the period of two decades (1980--2000), the commissions have have gone down from 1.2\% to 0.2\%. But with higher turnover and thus with increased volume, the total commissions have increased four-fold. The reduction in bid-ask spread although may be primarily due to tick size is accelerated under electronic trading. 


It must be observed that electronic trading does not necessarily imply automated trading. But it has certainly led to more automated trading due to easy execution of the algorithms. Although there is a concern that the traders can game the prices, but computer audit trails can be used to monitor unlawful behaviors. The debate over whether electronification of trading will lead to more consolidation or fragmentation has favored the latter. The apprehension over the possibility of inefficient price formation due to fragmentation is empirically shown not to hold. The order protection rule (SEC 2005) that dictates that an order submitted to any market should get the best of prices in all markets. 

Thus large number of equity and derivative markets are now organized as electronic limit order books. The Electronic Communications Networks (ECNs) in the United States, Hong Kong and Toronto Stock Exchanges are examples of equity markets. Chicago Mercantile Exchange's (CME) Globex platform, Euronext Liffe's centralized limit order book are example of derivative markets. Open limit order books have become popular due to the greater transparency of the market when compared with dealer market settings, that rely upon the information on the dealers' best quotes. The limit order book provides its users to view the depth of the book at various price level away from the best quotes. In dealer market prices for trades beyond the quoted size must be obtained through negotiation with market maker. 


There has been a great deal of interest in studying the information content of an open limit order book and if it helps investors in tracking short-term price predictions. Assuming that the market consists of informed and noise traders, and the informed traders actively submit market orders, Glosten (1994)~\cite{glosten94} and Seppi (1997)~\cite{seppi97} argue that the order book does not contain any information beyond the best bid and best offer. But other studies such as Harris and Panchapagesan (2005)~\cite{harrispan} argue that the order book is informative and specialists better use the book information to their advantage than the traders who routinely place limit orders. In this chapter we discuss the feature of limit order book and various levels of information that have been made available to the investors; the focus is on developing models for studying the dynamics on the book and how the models could be used for high frequency trading. 


An excellent survey paper by Parlour and Seppi (2008)~\cite{parseppi} reviews the issues related to limit order markets. A limit order for any asset `$j$' is an  ex ante pre-commitment $(t,x,p)$ made at time `$t$' to trade `$x$' units at a pre-specified limit price, `$p$'. The order remains valid until it is filled or cancelled. With multiple exchanges, the interactions are quite complex; the dynamic nature of state of the order book and the choice of actions in anticipation of the future states make the limit order placement decisions, $(t,x,p)$ challenging. The key issues in the study of LOB are nicely summarized in Parlour and Seppi (2008)~\cite{parseppi}. They relate to, Price Formulation (How limit order markets differ from dynamic dealer markets?), Liquidity (Implication of the quotes posted at various depths in LOB), Dynamics (Dependencies of Various Trading Decisions), Information Aggregation (How forward-looking is the activity in LOB about future order flow in aggregate?) and Inter-Market Competition (How effective are limit order markets to induce competition and how they handle non-market frictions?). How multiple exchanges can sustain competitive pressure to attract postings to their venues? How do limit order markets help reduce market frictions? These issues are addressed in this chapter but our focus is always on how the information flow through LOB dynamics helps trading decisions. The tools we review here in this chapter can be useful to that end. 


\section{Market Structure and Trading Venues: A Review}
\section{The Mechanics of Trading: The Limit Order Book}

In automated continuous double auction trading system that have become prevalent in financial markets, buyers and sellers submit limit orders electronically; orders are then matched and executed as per time and price priorities.\footnote{Not all exchanges are matching orders following a Price/Time priority algorithm; a key characteristic of the Futures market, for instance, is the existence of pro-rata markets for some fixed income contracts where passive child orders receive fill from aggressive orders based on their size as a fraction of the total passive posted quantity} The unmatched orders are stored in the limit order book (LOB) awaiting further execution. Market orders are orders seeking the best available price and they are executed immediately. Thus, one way or another all executed orders can be considered as marketable orders.


In practice the state of the order book changes quite rapidly due to he multi-agent nature of financial markets and the prevalence of high frequency trading. One can consider there are six types of events, three on either side, that can alter the state of the order book:
	\begin{itemize}
	\item Limit order submission: A limit order is added to the queue at the specified price level.
	\item Limit order cancellation: An outstanding limit order is expired or cancelled and therefore is removed from the LOB.
	\item Marketable order submission: outstanding limit orders at the best price and up to the demanded liquidity price level (in case of pure market order) or up to the limit price (for marketable limit order) are executed against the incoming order and thus removed from the book.
	\end{itemize}


Orders on the buy side are called ``bids'' while those on the sell side are called ``asks.'' The above events are illustrated in Figure~\ref{fig:limbk1} to Figure~\ref{fig:limbk3}. \\
	\begin{figure}[!ht]
	   \centering
	   \includegraphics[width=0.9\textwidth]{chapters/chapter_trading_fund/figures/limitbk1.png} 
	   \caption{Limit Order Book---Limit Bid. \label{fig:limbk1}}
	\end{figure}
	\begin{figure}[!ht]
	   \centering
	   \includegraphics[width=0.9\textwidth]{chapters/chapter_trading_fund/figures/limitbk2.png} 
	   \caption{Limit Order Book---Marketable Bid. \label{fig:limbk2}}
	\end{figure}
When a market (or marketable) order is submitted, it decreases the number of outstanding orders at the opposite best price. For example, if a market bid order arrives, it will decrease the number of outstanding asks at the best price.
	\begin{figure}[!ht]
	   \centering
	   \includegraphics[width=0.9\textwidth]{chapters/chapter_trading_fund/figures/limitbk3.png} 
	   \caption{Limit Order Book---Ask Cancellation. \label{fig:limbk3}}
	\end{figure}
All unexecuted limit orders can be cancelled. When a cancellation occurs, it will decrease the number of outstanding orders at the specified price level. \\


Limit orders make up a significant percentage (70\%) of stock market trading activity. The main advantage of a limit order is that there is no price risk associated to it, that is when the order is executed the limit price is the maximum (for a buy order) or minimum (for a sell order) price that will be achieved. But if the limit order is not marketable, the execution is not guaranteed and the time to get an order executed depends on various market factors. 
The trade off between limit orders and marketable orders depends on the investors need for immediate liquidity and the fill probability of limit orders. The limit price chosen (how deep in the order book is the order placed) as well as the amount of liquidity ahead of the submitted order (how many shares will need to trade before the order gets executed following, for instance, a price/time priority order matching of the exchange) affect both the order fill probability as well as its expected time to fill. These two metrics are of particular relevance for execution algorithms and will be studied in more depth later. 
The execution of limit orders does affect how the quotes are posted and are updated.  
If the size of a market order exceeds the number of shares available at the top of book, it is usually split and is executed at consecutive order book levels until the order is filled. Market orders are usually restricted to be filled within a day and order placed after the markets close might be entered the next day. 
While we mostly considered limit and market orders, it is worth mentioning there exist a wide variety of orders types offered by different exchanges to facilitates certain types of trading activities. Two additional common order types are stop-limit orders and trailing stop orders. The former type is typically used to trade a security at a specified limit price once it traded through a given stop price. If the stock declines in value and trades below or at the stop price, the order will become a limit order rather than a market order. Trailing stop orders follow a similar objective but the stop price trails the best bid or ask by a certain percentage. These order types are primarily used by traders as a protection against sudden adverse market moves. \\

In addition to conditions on price, it is possible to add conditions on the life duration of the order known as Time-in-Force (TIF). The most common types of TIF instructions include Day orders which are valid for the full duration of the trading session and Good-Till-Cancel (GTC) orders which will be placed again on the exchange the next day with similar instructions if they were not fully filled. More sophisticated market participants aiming at achieving greater control over their executions tend to also favor Immediate-or-Cancel (IOC) and Fill-or-Kill (FOK) Time-in-Force instructions. An IOC order will get immediately cancelled back to the sender after reaching the matching engine if it doesn't get immediately a fill, and , in case of a partial fill, the unfilled portion of will also be cancelled, thus preventing it from creating a new price level in the order book. In a Fill-or-Kill scenario, the order gets either filled in its entirety or doesn't get filled at all. This instruction is particularly popular with high frequency market makers and arbitrageurs for which partial fills might result in unwanted legging risk as discussed in the Pairs Trading chapter. \\

Finally, it worth mentioning that some exchanges as well as alternative venues offer the ability of specifying minimum fill sizes whereby a limit order which might be eligible for a fill due to an incoming order at the same price level only receives a fill if the incoming order is larger than a pre-specified number of shares or notional value. This type of instruction is used by market participants as a way of minimizing the number of small fills which carry the risk of excessive information dissemination, in particular in dark pools where they can be used to detect the presence of larger limit orders that would otherwise not be visible to market participants.  

\subsection{How Double Auction Markets Work}

The term double auction refers to the nature of the markets where, unlike a common auction with one auctioneer and many potential buyers, there are many buyers and many sellers.



\subsubsection{Order Types}
\subsubsection{The Open Auction}

The Open Auction is only one of the types of call auctions that are commonly held on exchanges. The term "call auction" explains the liquidity aggregation nature of this event. Market participants are 'called' to submit their quotes to the market place, at a consistent time, in order to determine a matching price that will maximize the amount of shares that can be transacted. \\

INSERT ACTUAL MECHANICS \\

It is worth mentioning that the open auction tends to be considered as a major price discovery mechanism given the fact it occurs after a period of market inactivity when market participants were unable to transact. All new information accumulated overnight will be reflected in the first print of the day, matching buying and selling interests.  

As market participants with better information are more likely to be participating in the open auction with more aggressive orders in order to extract liquidity (and, as such, setting the price), the price discovery mechanism is often considered to be quite volatile and more suited for short-term alpha investors. Similarly, the period immediately following the open auction also tends to be much more volatile than the rest of the day. As a result of which, most markets experience wider spreads while market makers try to protect themselves against information asymmetry by quoting wider bid and offers. 
The increased volatility and wider spreads might discourage certain investors from participating in the market at the open auction and in the period immediately following the open. While this appears to be a reasonable idea from a price risk perspective, it is worth mentioning that for a lot of less liquid stocks (in particular small and mid cap stocks), the open auction can be a significant liquidity aggregation point that even surpasses the close auction. In Australia for instance, the bottom 50\% less liquid stocks have more volume trade in the open auction than in the close auction. Similarly, in Japan, the less liquid names see more volume trade in the open auction, but also in the afternoon open auction that follows the market lunch break.\\

From a pure execution standpoint, though, the usage of the open auction has to be considered carefully. While this represents a liquidity opportunity, the first print of the day can also have a significant anchoring effect on the stock price for the remainder of the day. So, participating in the open should be considered in light of the liquidity demand of the order: orders that are small enough can likely do without participating in the open auction and the continuous period immediately following; while large orders trying to extract significant liquidity from the market might likely benefit from participating in the open auction.


\subsubsection{Continuous Trading}

THE BORING PART .... INSERT ACTUAL MECHANICS \\


\subsubsection{The Closing Auction}

The Closing Auction tends to be the most popular of the call auctions for a variety of interesting reasons. Firstly, it is the last opportunity (exception made of off-hours trading) when market participants can transact in a relatively liquid environment before being exposed to the overnight period (when new information accumulates, but trades cannot easily take place). Secondly, with the increase in passive investment strategies providing investors with replication of a predetermined benchmark, the closing auction has become a particularly relevant price setting event (most passive funds NAV is based on close prices of the underlying assets). 

For such reasons, the closing auction is particularly important to many investors. From an execution standpoint, it is a major liquidity event that needs to be considered carefully. \\

INSERT ACTUAL MECHANICS \\

A large number of Quant and CTA funds are building their investment strategies using daily returns, essentially using the close price as a reference price for their investment decisions. Once their backtesting is built on close price data, they aim at obtaining an execution price equal to - or better than - the close price when implementing their strategies. 

It also represents a liquidity opportunity for active and passive investors to exchange large amounts of shares. As index constituents get updated on a regular basis (additions, deletions, weight increase/decrease) passive investors need to update their holdings to reflect the optimal composition of the benchmark they track and, in order to minimize their tracking error risk, that update needs to happen as close as possible to the actual update of the underlying benchmark. Consequently, most passive indexers tend to rebalance their portfolios on the same day the underlying index constituents are updated, using the close auction as a reference price, and resulting in significant flows at the close auction. Consequently, active investors looking to build a significant position (or unwinding one) can use these index events as a way of transacting a large amount of shares with low market impact at the close by being a liquidity providers to passive indexers.  



\subsection{Market Data}

Historical market data available to researchers and practitioners alike varied in degrees of granularity over time. From daily trade data (closing price and volume), to tick-by-tick trade and quote data (also known as TAQ data), to full message data, the progressive increase in granularity not only reflects the increase in intraday trading complexity but also opens up the way for more advanced strategies. \\

Initially researchers studying the dynamic of LOB had to be content with Trades and Quotes (TAQ) data which provide a time-stamped sequence of trades (Market Orders) and updates in the price and depth of bid and ask quotes. No other information beyond the best bid and the best offer are made available. Moreover, the updates contain changes at the two quotes and were aggregated. The aggregation was clearly a limiting factor as one could not discern the kind of events that led to the changing status of the book. The level II data that became available is a time-stamped sequence of trades and quotes for the top 5-levels of the LOB. This data is little deeper than TAQ data, but was still in aggregated form. But recently made available level III data contains time-stamped sequence of all (except for hidden orders) events that occur in the LOB. Every order is identified by a unique order-id and thus it can be tracked through its lifetime. \\



\subsubsection{Reference Data}

While often overlooked, or merely considered as an after thought in the development of a research platform, reliable reference data is the key foundation of a robust quantitative strategy development.

Commonly used reference data falls into different categories:

\begin{itemize}
\item \textbf{Symbology Mapping:} ISIN, SEDOL, RIC, Bloomberg Tickers, ... 

Quantitative strategies often leverage data from a variety of sources. Different providers key their data with different instrument identifiers depending on asset class or regional conventions, or sometime use their own proprietary identifiers (e.g. Reuter Identification Code - RIC, Bloomberg Ticker), therefore making symbology mapping the first step in any data join exercise. Such data is not static, one of the symbols can change on a given day and others remain unchanged for some time, complicating historical data joins even more.

It is important to note that such mapping needs to be persisted as point-in-time data and allow for historical "as of date" usage. Over the course of time, some instruments undergo ticker changes (for example from ABC to EDF on date $T_0$) without necessarily any particular change on the underlying asset. In such cases, market data recorded day-by-day in a trade database will change from being keyed on ABC to being keyed on EDF after the ticker change date $T_0$. This has large implications for practitioners working on datasets to build and backtest quantitative strategies. The symbology mapping should allow both backward and forward handling of the changes.

For instance, in the simple example mentioned, in order to efficiently backtest strategies over a period of time spanning $T_0$, one needs a robust mapping that will allow to seamlessly query the data for the underlying asset in a variety of scenarios such as:

\begin{itemize}
\item Signal generation: 30-day backward close time series as of date T < $T_0$:

{\tt select close from data where date in [T-30,  T], sym=ABC}

\item Signal generation: 30-day backward close time series as of date T = $T_0$+10:

{\tt select close from data where date in [$T_0$-20,  $T_0$+10], sym=EDF}

\item Position holding: 30-day forward close time series as of date T = $T_0$-10

{\tt select close from data where date in [$T_0$-10,  $T_0$+20], sym=ABC}

\end{itemize}

\item \textbf{Ticker Changes:} 

For comparable reasons as the ones described above in the Symbology Mapping section, one needs to maintain a historical table of ticker changes allowing to seamlessly go up and down time series. 


\item \textbf{Corporate Actions Calendars:} stock and cash dividends (both announcement date and ex date), stock splits, reverse splits, rights offer, mergers and acquisitions, spin off, free float or shares outstanding adjustments, quotation suspension.

Corporate actions impact the continuity of price and volume time series and, as such, need to be recorded in order to produce adjusted time series. The most common events are dividend distributions. On the day the dividend is paid, the corresponding amount is removed from the stock price, creating a jump in the price time series. The announcement date might also see the stock experience added volatility as investors react to the news. Consequently, recording these events proves to be valuable in the design of quantitative strategies as one can assess the effect on performance of dividends announcement or payment, and decide to either not hold a security that has an upcoming dividend announcement or, conversely, to build strategies that look to benefit from the added volatility. 

Additional types of corporate actions generating discontinuity in historical time series are stock splits or reverse splits and right offers. When the price of a stock becomes either too low or too high, a company might seek to split it to bring the price back to a level that is more conducive to liquid trading on exchanges\footnote{A very low price creates trading frictions as the minimum price increment might represent a large cost relative to the stock price. A very high price might also deter retail investors from investing into a security as it requires them to deploy too much capital per unit.}. When a stock experiences a 2:1 split, everything else being equal, its price will be halved and its volume will double. In order to prevent the time series to show a 50\% drop in price, all historical data will then need to be adjusted backward to reflect the split.

Mergers \& Acquisitions and Spin-offs are also regular events in the lifecycle of corporations. Their history needs to be recorded in order to account for the resulting changes in valuation that might affect a given ticker or tickers. These situations can also be exploited by trading strategies known as Merger Arbitrage.

Stocks quotation can be suspended as a cooling mechanism (often at the request of the underlying company) to prevent excess price volatility when significant information is about to be released to the market. Depending on the situation, the suspension can be temporary and intraday, or can last for extended periods of time if the market place allows it\footnote{For instance, it was the case for a large number of companies in China in 2016.}. Suspensions result in gaps in time series and are worth keeping track of as they can impact strategies backtesting (inability to to enter or exit a position, uncertainty in the pricing of composite assets if a given stock has a significant weight in ETFs or Indexes). 
Some markets will also suspend trading if the price swings more than a predefined amount (limit up / limit down situations) for either a period of time or for the remainder of the trading session.

\item \textbf{Static Data:} country, sector, primary exchange, currency and quote factor.

Pure static data is also relevant for the development of quantitative trading strategies. In particular, country, currency and sector are useful to group instruments based on their fundamental similarities. A well known example is the usage of sectors to group stocks in order to create pairs trading strategies. It is worth mentioning that there exist different types of sector classifications (e.g. GICS\textsuperscript\textregistered from S\&P, ICB\textsuperscript\textregistered from FTSE) offering several levels of granularity\footnote{The Global Industry Classification Standard (GICS) structure consists of 11 sectors, 24 industry groups, 68 industries and 157 sub-industries. An example of this hierarchical structure would be: Industrials / Capital Goods / Machinery / Agricultural \& Farm Machinery.}, and that different classifications might be better suited to different asset classes or countries. The constituents of the Japanese index TOPIX, for instance, are classified into 33 sectors that are thought to better reflect the fundamental structure of the Japanese economy and the existence of large diversified conglomerates. 

Maintaining a table of the quotation currency per instrument is also necessary in order to be able to aggregate positions at a portfolio level. Some exchanges allow the quotation of prices in currencies different from the one of the country in which the exchange is located \footnote{For example, Jardine Matheson Holdings quotes in USD on the Singapore exchange while most of the other securities quote in Singapore Dollars.}. Additionally, the Quote Factor associated with the quotation currency time series needs to be stored. To account for the wide range of currency values and preserve pricing precision, market data providers might be publishing FX rates with a factor of 100 or 1000. Hence, to convert prices to USD one needs to multiply by the quote factor: $usd price = local price * fx * quote factor$. Similarly, some exchanges quote prices in cents, and the associated quotation currency is reflected with a small cap letter: GBP/GBp, ZAR/ZAr, ILS/ILs, ...).

\item \textbf{Exchange Specific Data:}  

Despite the electronification of markets, individual exchanges present a variety of differences that need to be accounted for when trading strategies. The first group of information concerns the hours and dates of operation:

\begin{itemize}
\item Holiday calendar: as not all exchanges are closed on the same day, and trading days off do not always fully follow the country public holidays, it is valuable to record them in particular in an international context. Strategies trading simultaneously in several markets might not perform as expected if one of the markets is closed while the others are open. Similarly, execution strategies in one market might be impacted by the absence of trading in another market (for instance, European equities markets volume tends to be 30\% to 40\% lower during U.S. market holidays).
\item Exchange sessions hours: 

Exchange session hours, auction times as well as their respective cut-offs for order submission, lunch break hours, 
F\&O Sessions and end of trading vs. settlement time

In Indonesia, for instance, markets have different trading hours on Fridays. Monday through Thursday the Indonesia Stock Exchange (IDX) is open from 9:00 AM to 12:00 PM, and then, from 1:30 PM to 4:00 PM. On Fridays, however, the lunch break is one hour longer and stretches from 11:30 AM to 2:00 PM. This weekly seasonality effect is particularly important to consider when building volume profiles as described in the next chapter.
Along with local times of operation, it is necessary to consider eventual Daylight Saving Time (DST) adjustments that might effect the relative trading hours of different markets (some countries do not have DST adjustment at all, while for countries that do have one, the dates at which it applies are not always coordinated). Usually, DST starts about two weeks prior to its start in Europe, bringing the time difference between New York and London to 4 hours instead of 5 hours. This results in the volume spike in European equities associated to the U.S. market open being one hour earlier, requiring adjustment of volume profiles used for trading execution.
Some exchanges might also adjust the length of trading hours during the course of the year. In Brazil for instance, the Bovespa trading hours are 10:00 AM to 6:00 PM from October to March, but an hour shorter (10:00 AM to 5:00 PM) from April to September to be more consistent with U.S. market hours.
Finally, within one country there might also exist different trading hours by venues as it is the case in Japan where the Nagoya Stock Exchange closes 30 minutes after the major Tokyo Stock Exchange.
\item Disrupted days: exchanges outages or trading disruptions, as well as market data issues, need to be recorded so they can be filtered out when building or testing strategies as the difference in liquidity patterns or the lack of data quality might impact the overall outcome.

\end{itemize}

Additionally, exchanges also have specific rules governing the mechanics of trading, such as:
\begin{itemize}
\item Tick Size: 
\item Trade and Quote lots:
\item Limit-up and Limit-down constraints:
\item Short Sell restrictions
\end{itemize}

\item \textbf{Market Data Condition Codes:} 

With ever-growing market microstructure complexity, market data dissemination has grown proportionally complex as well. While it is possible to store daily data as a single entry per day and per instrument, investors building intraday strategies likely need to collect tick by tick data of all the events occurring in the market place. To help classify events, exchanges and market data providers attribute so-called condition codes to the trades and quotes they publish. These condition codes vary per exchange and per asset class, and each market event can be attributed several codes at once. So, to aggregate intraday market data properly and efficiently, and decide which events to keep and which ones to exclude, it is necessary to build a mapping table of these condition codes and their meaning: auction trade, lit or dark trade, cancelled or corrected trade, regular trade, off-exchange trade reporting, block-size trade, trade originating from a multi-leg order such as an option spread trade, ... 

For instance, in order to assess accessible liquidity for a trading algorithm, trades that are published for reporting purposes (e.g. negotiated transactions that happened off-exchange) need to be excluded. These trades should also not been used to update some of the aggregated daily data used in the construction of trading strategies (daily volume, high, low, ...). Execution algorithms also leverage extensively intraday liquidity distribution metrics to gauge their own participation in auctions and continuous sessions, or in lit versus dark venues, therefore requiring a precise classification of intraday market data. 

\item \textbf{Special Day Calendars:} 

Over the course of a year, certain days present liquidity characteristics that need to be accounted for in both execution strategies or alpha generation. Here too, the diversity of events across markets and asset classes can be quite challenging to handle. Among the irregular events that affect liquidity in equities markets and need to be accounted for, we can mention the following non-exhaustive list for illustration purposes: half trading days following Christmas and Thanksgiving in the U.S. or on the Ramadan eve in Turkey; Taiwanese market opening on the weekend to make up for lost trading days during holiday periods; Korean market changing its trading hours on the day of the nationwide university entrance exam; Brazilian market opening late on the day following the Carnival; etc. 

There are also special days that are more regular and easier to handle. The last trading days of the months and quarters, for instance, tend to see additional trading activity as investors rebalance their portfolios. Similarly, options and futures expiry days (quarterly/monthly expiry, 'Triple Witching'\footnote{Triple witching days happen four times a year on the third Friday of March, June, September and December. On these days, the contracts for stock index futures, stock index options and stock options expire concurrently.} in the U.S., Special Quotations in Japan, etc.) tend to also have relative excess trading volume and different intraday patterns resulting from hedging activity and portfolios adjustments. Consequently, they often need to be handled separately, in particular when modeling volume. As most execution strategies make use of relatively short interval volume metrics (e.g. 30-day or 60-day ADV), one single data point can be enough to impact the overall level inferred. Similarly autoregressive models of low order might underperform both on special days and on the days following them. As a result, modelers often opt for removing special days from datasets and model normal days first. Then, special days are modeled separately, either independently or using the normal days as a baseline. 

In order to reflect changes in the market and remain consistent with index inclusion rules, most indexes need to undergo regular updates of their constituents as well as their respective weights. Most of the significant indexes do so at regular intervals (annually, semi-annually or quarterly) on a pre-announced date. At the close of business of that day, some stocks might be added to the index while others are removed, or the weight of each stock in the index might be increased or decreased. These events, known as index rebalances, are particularly relevant to passive investors who are tracking the impacted index. In order for them to minimize the tracking error to their benchmark index, they need to also adjust their holdings accordingly. Additionally, as most funds are benchmarked at the close price, there is an incentive for fund managers to try to rebalance their holdings at a price as close as possible to the official close price of the day the index rebalance becomes effective. As a result, on these days, intraday volume distribution is significantly skewed toward the end of day and requires adjustment of execution strategies.

It is worth noting that a special day calendar usage needs not be limited to the country where the event occurs. On days when the U.S. Equities market is closed, there is usually also a significant drop in volume traded in European markets, so it is always valuable to investigate the cross sectional effect of special days.


\item \textbf{Futures-specific Reference Data:} 

Futures contracts present particular characteristics requiring additional reference data to be collected. One of the core differences of futures contracts compared to regular stocks is the fact that instruments have an expiry date, after which they cease to exist. For the purpose of backtesting strategies, it is necessary to know which contract was live at a point in time through the use of an expiry calendar, but also which contract was the most liquid (for instance, equity index futures tend to be the most liquid for the first contract available (also known as front month) while energy futures such as oil tend to be more liquid for the second contract. While this may appear to be trivial, when building a trading strategy and modeling prices time series, it is particularly important to know which contract carries the most significant price formation characteristics and what is the true liquidity available in order to estimate transaction costs such as market impact. 

The task of implementing a futures expiry calendar is further complicated by the fact there is no real standardized frequency that applies across markets. For instance, European equity index futures tend to expire monthly, while U.S. index futures expire quarterly. Some contracts even follow an irregular cycle through the course of the year as it is the case for grain futures (e.g. wheat) that were originally created for hedging purposes and as a result have expiry months that follow the crop cycle (GIVE AN EXAMPLE OF WHEAT FULL YEAR CYCLE).

The fact futures contracts expire on a regular basis has further implications in terms of liquidity. As investors holding these contracts might want to maintain their exposure for longer than the lifespan of the contract, they need to roll over their positions onto the next contract. There is often a noticeable difference in the liquidity of consecutive contracts (for instance, the front contract of the S\&P500 (e.g. ESM8) trades roughly 2 million contracts per day -- NEED TO CHECK ACTUAL ADV -- while the next month contract (ESH8) only trades 100,000 contracts per day --- NEED TO CHECK THE ACTUAL ADV --. However, this liquidity relationship will invert in the few days leading to the expiry of the front contract as most investors roll their positions, and the most liquid contract will become the back month contract (INSERT GRAPH). As a result, when computing rolling-window metrics (such as average daily volume for instance), it is necessary to account for potential roll dates that might have happen during the span of the time series. In the example above, a simple 60-day average daily volume on ESH8 taken in early April 2018 would capture a large number of days with very low volume (January-March) owing to the fact the most liquid contract at the time was the ESM8 contract, and not accurately represent the volume activity of the S\&P500 futures contract. A more appropriate average volume metric to be used as a forward looking value for execution purposes would blend the volume time series of ESH8 prior to the roll date, and ESM8 after the roll date\footnote{It is worth noting that different contracts 'roll' at different speed. While for monthly expiry contracts it is possible to see most of the open interest switch from the front month contract to the back month on the day prior to the expiry, for quarterly contracts it is not uncommon to see the roll happen over the course of a week or more, and the front month liquidity vanish several days ahead of the actual expiry. Careful modeling is recommended on a case by case basis.}. 

Additionally, in order to efficiently merge futures positions with other assets in an investment strategy, one needs to store reference data relative to the quotation of these contracts: contract size (translation between the quotation points and the actual monetary value), currency, etc. 

Finally, futures markets are characterized by the existence of different market phases during the day, with significantly different liquidity characteristics. For instance, equity index futures are much more liquid during the hours when the corresponding equities markets are open. However, one can trade during the overnight session if they need to. The overnight session being much less liquid, the expected execution cost tends to be higher, and as such, the various market data metrics (volume profile, average spread, average bid-ask sizes, ...) should be computed separately for each market phase, which requires maintaining a table of the start and end times of each session for each contracts. 

\item \textbf{Options-specific Reference Data:} Options chain

Similar to futures contracts, options contracts present a certain number of specificities for which reference data need to be collected. On top of the similar feature of having a particular expiry date, options contracts are also defined by their strike price. The combination of expiries and strikes is known as the the option chain for a given underlier. 

The ability to map equities tickers to options tickers and their respective strike and expiry date allows for the design of more complex investment and hedging strategies. For instance, distance to strike, change in open interest of puts and calls, open interest can all be used as signals for the underlying security price.

\item \textbf{Market-Moving News Releases:} 

Macro-economic announcements are known for their ability to move markets substantially. Consequently, it is necessary to maintain a calendar of their occurrences in order to assess their impact on strategies and decide how to best react to them. The most common ones are central banks announcements or meeting minutes releases of the major economies (FED/FOMC, ECB, BOE, BOJ, SNB), Non-Farm Payrolls, PMI, Crude Oil Inventories, etc.

While these news releases impact the broad market or some wide sectors, there are also stock specific releases that need to be tracked. 
Earning calendars (dates and times / backward and forward), specialized sector events such as FDA results for the healthcare and biotech sectors  .... (Dates and times / backward and forward)



\item Related tickers: Primary tickers to composite ticker mapping, dual listed/fungible securities in US and Canada, local and foreign boards in Thailand, 

\item \textbf{Composite Assets:} time series of constituents, time series of divisor (eg change in free float,...), time series of cash components, mapping to underlying ticker, 

\item \textbf{Latency tables:} routing, market data collection

This latest type of data would only be of interest for strategies and research in the higher frequency trading space. For these, it might be relevant to know the distribution of latency between different data centers as they can be used for more efficient order routing as well as reordering time series that might have been recorded in different locations.

\end{itemize}

While the points mentioned above represent a non exhaustive list of the reference data available to build a quantitative research platform, they highlight the challenges that need to be accounted for when designing and implementing algorithmic trading strategies. Once in place, a proper set of reference data will allow to harness the actual content of the following types of data.

\subsubsection{Fundamental Data}

\begin{itemize}
\item key ratios: EPS, P/E, P/B, ...
\item Analyst recommendations, consensus, price targets
\item Earnings consensus
\item Holders // check FINRA/SEC filing forms
\item Insiders Purchase/Sale // check FINRA/SEC filing forms
\end{itemize}

\subsubsection{Daily Statistics}

\begin{itemize}
\item Open, High, Low, Close (OHLC) / Prev Close Price and Date (for computation efficiency such as overnight gap: but needs careful 'adjust=True...), last before close Time/Price
\item Volume + lit/dark breakdown
\item VWAP
\item Short Interest / utilization / days-to-cover
\item Auctions volume (up to 4 of them, + liquidity / intraday ones)
\item Spread (avg, med, twavg) --> or better: parametrized distribution which can then be used in a Bayesian update setup
\item Number of trades
\item Trade size (avg, med) --> or better: parametrized distribution which can then be used in a Bayesian update setup
\item Number and frequency of quote updates 
\item Top of book size
\item Depth of book (price and size)
\item Ticking time (avg, med) --> or better: parametrized distribution which can then be used in a Bayesian update setup
\item Futures and Options:
\begin{itemize}
\item Open Interest
\item Greeks 
\item Implied Vol
\item Basis / dividends estimates
\item Fair Value
\end{itemize}

\item Index-level data for relative measures: OHLC, Overnight gap, ..., benchmark rates (repo, 2y, 10y, 30y?)
\item Asset Class Specific: FI, FX, Credit
\begin{itemize}
\item Yield
\item CDS Spread
\item Closed End Fund: premium / discount
\item USDollar Index
\end{itemize}

\end{itemize}

Can also include pre-computed aggregated X-day trailing data (essentially for computation efficiency in backtest), in particular for normalisation purposes (eg size as a percentage of ADV, spread in relation to long-term average, ...)
\begin{itemize}

\item X-day volatility
\item X-day ADV / Avg auction Volume
\item Beta (full, up-days/down-days) wrt index or sector
\item Correlation to reference index
\end{itemize}

--> Aggregated data need to fully support the peculiarities described in the Reference Data section (for instance: existence of special or event days which, if included, can significantly skew intraday distribution of values; mishandling of market asynchronicity resulting in inaccurate sensitivities computations such as beta or correlation)

\subsubsection{Bin Data}

Aggregated bar data....
Particularly useful to detect seasonalities eg Spread size shrinking in the post-open price discovery period and for quick backtesting of intraday trading strategies

\subsubsection{Level 1: Trade, Quotes, BBO and NBBO}

Superbook \\
Trade time, trade exch time, trade source time \\
Price, size, bid ask price size \\
Quote time, exch time, source time \\
Trade status \\
LULD indicator \\
Qualifiers TRADES AND QUOTES \\
Part ID

\subsubsection{Level 2: Market Depth}


\subsubsection{Level 3: Orders}

--> mention that for generalisation purposes we take the example of US Level 3 data, in particular w.r.t. Table 8.1  \\

\noindent\textbf{Description of Level III data:} The dataset consist of activities during the entire trading session, including early and late hours from 6:00~A.M. to 8:00~P.M. EST in a trading day. It provides intraday depth book activity for 12000 tickers from major national exchanges: Nasdaq, Direct Edge, NYSE, ARCA and BATS (exact number of exchanges depends on the historical period). All messages are consolidated into one file ordered by timestamp. This data allows to build a full national depth book at any moment intraday. The description of the level III data is given in Table~\ref{tab:level3data}. \\
	\begin{table}[!ht]
	\centering
	\begin{tabular}{lp{0.8\textwidth}} \hline
	Variable & Description \\
	& \\
	Timestamp: & Number of milliseconds after the midnight. \\
	& \\
	Ticker: & Equity symbol (up to 8 characters) \\
	& \\
	Order: & Unique order ID. \\
	& \\
	T & Message type. Allowed values: \newline \begin{minipage}[t]{0.6\textwidth} \begin{itemize} \item ``B''---Add buy order \item ``S''---Add sell order \item ``E''---Execute outstanding order in part \item ``C''---Cancel outstanding order in part \item ``F''---Execute outstanding order in full \item ``D''---Delete outstanding order in full \item ``X''---Bulk volume for the cross event \item ``T''---Execute non-displayed order \end{itemize} \end{minipage} \\
	& \\
	Shares & Order quantity for the ``B'', ``S'', ``E'', ``X'', ``C'', ``T'' messages. Zero for ``F'' and ``D'' messages. \\
	& \\
	Price & Order price, available for the ``B'', ``S'', ``X'' and ``T'' messages. \newline Zero for cancellations and executions. The last 4 digits are decimal digits. The decimal portion is padded on the right with zeros. The decimal point is implied by position; it does not appear inside the price field. Divide by 10000 to convert into currency value. \\ 
	& \\
	MPID & Market Participant ID associated with the transaction (4 characters) \\
	& \\
	MCID & Market Center Code (originating exchange---1 character) 
	\end{tabular}
	\caption{Level III data \label{tab:level3data}}
	\end{table}
	

\noindent\textbf{Special types of orders:} While the display and issuance of new ID to the modified order varies from exchange to exchange, we provide a brief description of these orders below:

\begin{enumerate}[1.]
\item Order subject to price sliding: the execution price could be one cent worse than the display price at NASDAQ; it is ranked at the locking price as a hidden order, and displayed at the price one minimum price variation (normally 1 cent) inferior to the locking price. New order ID will be used if the order is replaced as a display order. At other exchanges the old order ID will be used.

\item Pegged order: Based on NBBO, not routable, new timestamp upon re-pricing, display rules vary over exchanges.

\item Mid-point peg order: Non-displayed, can result in half-penny execution.

\item Reserve order: displayed size is ranked as a displayed limit order and the reserve size is behind non-displayed orders and pegged orders in priority. The minimum display quantity is 100 and this amount is replenished from the reserve size when it falls below 100 shares. A new timestamp is created and the displayed size will be re-ranked upon replenishing.

\item Discretionary order: displayed at one price while passively trading at a more aggressive discretionary price. The order becomes active when shares are available within the discretionary price range. Ranked last in priority. The execution price could be worse than the display price.

\item Intermarket sweep order: order that can be executed without the need of checking the prevailing NBBO.  
\end{enumerate}


Some key measures of the LOB are: relative position of an order from the top position of the side (buy or sell), the depth which is the total number of shares at a given price and the depth profile of the book reflects the depth of both prices. Large market orders can shift the bid and ask prices. If the limit price of a new order crosses the best price on the opposite side of the book, it is executed immediately and these are termed as crossing or marketable limit orders. These are used at times to explore the existence of hidden orders.


The limit order book data provides a rich source of information to better understand the market microstructure. The information is also useful for developing trading strategies. Some key issues that may be explored are:

\begin{itemize}
\item The pattern of inter-arrival times of various events.
\item Arrival and cancellation rates as a function of distance from nearest touch price.
\item Arrival and cancellation rates as a function of other available information, such as in the queue on either side of the book.
\end{itemize}

The key issues from the trading point of view are:

\begin{itemize}
\item What is the impact of market order on the limit order book?
\item What are the chances for a limit order to move up the queue from a given entry position?
\item What is the probability of making the spread?
\item What is the direction of the price movement in short duration?
\end{itemize}

\section{The Dynamics of Trading: Market Micro-structure}

Market structure constraints imposed on execution:

\begin{itemize}
\item tick sizes
\item Short sell rules
\item Long queue names
\item 10b-18 rule in US equity
\item Pro-rata markets
\end{itemize}

\section{Execution and its components}
\subsection{Benchmarks}

\begin{itemize}
\item Arrival
\item Inline
\item Full day or Period VWAP
\item Close
\item "All of the above" while completing as much as possible
\end{itemize}

Additional metrics considered for execution performance:
\begin{itemize}
\item completion rate
\item Make/take ratio
\item Mean vs Variance of performance...
\end{itemize}

The benchmark represents a quantitatively measurable observation of the execution objective, which needs to be translated into a series of actual trading actions which are described below


\subsection{Scheduling}

The Macro Trader --> ANSWERS THE QUESTION: How much should I trade in each period?

\begin{itemize}
\item Auctions: to partake or not to partake?
\item Spread Cost vs Liquidity Reward in the "price discovery" period post-open
\item Intraday volume patterns (see next chapter). The value of total day forecast vs intraday distribution?
\item Weekly seasonalities: Monday's are price discovery days, Wed are great?
\item Special days: index events and expiries, quoting deeper at times of news release, ...
\end{itemize}


\subsection{Order Placement (Lit and Dark)}

The Micro Trader --> ANSWERS THE QUESTION: At what price should I trade?

Lit and Dark order placements present different challenges. While lit executions are directly observable and can be observed in public market data feeds, dark executions tend to be reported in aggregate, thus making attribution of actual execution venue more challenging. For instance, if solely observed from market data, dark executions in the US cannot be directly attributed one of the non-displayed venues. However, if observed from the point of view of an executing entity (through execution fills received), one can obtain sensored observations of the available -- otherwise invisible -- liquidity (I.e. When receiving a fill for X shares one knows there was at least X shares available to trade on the other side).

\begin{itemize}
\item Lit Order Placement logic:

\item Dark Order Placement logic: the question one needs to answer here is: given X shares to execute and Y available venues, what is the combination of shares sent to different venues that maximizes the fill probability and minimizes the time to fill?

\end{itemize}


\subsection{Order Routing}

The Smart Order Router --> ANSWERS THE QUESTION: Where should I trade in a fragmented marketplace?

This is only a particular concern in markets that present a significant level of fragmentation, such as the US equity market. 

\begin{itemize}
\item Probability of Fill: how probable is it to get filled? 

\item Time to fill
\end{itemize}


\subsection{RFQ Markets}
What happens in other asset classes???